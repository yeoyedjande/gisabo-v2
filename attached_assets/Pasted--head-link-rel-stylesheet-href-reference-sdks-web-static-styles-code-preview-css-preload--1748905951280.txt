<head>
  <link rel="stylesheet" href="/reference/sdks/web/static/styles/code-preview.css" preload>
  <script src="https://sandbox.web.squarecdn.com/v1/square.js"></script>
</head>
<body>
  <div id="payment-form">
    <div id="payment-status-container"></div>
    <div id="afterpay-button"></div>
  </div>

  <script type="module">
    const payments = Square.payments('sandbox-sq0idb-RT3u-HhCpNdbMiGg5aXuVg', 'TC4Z3ZEBKRXRH');

    const paymentRequest = payments.paymentRequest({
      countryCode: 'US',
      currencyCode: 'USD',
      total: {
        amount: '1.00',
        label: 'Total',
      },
      requestShippingContact: true,
    });
    paymentRequest.addEventListener('afterpay_shippingaddresschanged', function () {
      return {
        shippingOptions: [
          {
            amount: '0.00',
            id: 'shipping-option-1',
            label: 'Free',
            taxLineItems: [
              {
                amount: '0.00',
                label: 'Tax',
              },
            ],
            total: {
              amount: '1.00',
              label: 'total',
            },
          },
        ],
      };
    });

    const afterpay = await payments.afterpayClearpay(paymentRequest);
    await afterpay.attach('#afterpay-button');

    const afterpayButton = document.getElementById('afterpay-button');
    afterpayButton.addEventListener('click', async function (event) {
      const statusContainer = document.getElementById('payment-status-container');

      try {
        const tokenResult = await afterpay.tokenize();
        if (tokenResult.status === 'OK') {
          console.log(`Payment token is ${tokenResult.token}`);
          statusContainer.innerHTML = "Payment Successful";
        } else {
          let errorMessage = `Tokenization failed with status: ${tokenResult.status}`;
          if (tokenResult.errors) {
            errorMessage += ` and errors: ${JSON.stringify(
              tokenResult.errors
            )}`;
          }

          throw new Error(errorMessage);
        }
      } catch (e) {
        console.error(e.message);
        statusContainer.innerHTML = "Payment Failed";
      }
    });
  </script>
</body>
